{% extends theme('layout.html') %}
{% set active_page = 'admin' %}
{% block title %}管理{% endblock %}
{% block content %}
<div class="ui page stackable grid">
  <div class="bottom aligned row">
  <div class="four wide column">
    <div class="ui fluid vertical pointing menu">
      <div class="header item">
        <i class="home icon"></i> 导入主题
      </div>
      <div class="item">
        <div class="menu">
          <a class="item" href="{{ url_for('.import_all', option=0) }}">忽略已存在的记录</a>
          <a class="item" href="{{ url_for('.import_all', option=1) }}">更新已存在的记录</a>
          <a class="item" href="{{ url_for('.import_all', option=2) }}">重建已存在的记录</a>
        </div>
      </div>
      <div class="header item">
        <i class="mail icon"></i> 清理主题
      </div>
      <div class="item">
        <div class="menu">
          <a id="clean" class="item">清理主题</a>
          <a class="item">清空全部主题</a>
        </div>
      </div>
    </div>
  </div>
  <div class="twelve wide column">
    <div id="result" class="ui success message" style="display: none;">
      <p></p>
    </div>
    <div class="ui active green striped progress">
      <div id="progress" class="bar"></div>
    </div>
  </div>
  </div>
</div>

{% endblock %}
{% block script%}
<script>
/* 清理主题，显示进度 */
var timeSet;
$("#clean").click(function(){
  $("#progress").css("width", "0");
  $("#progress").parent().addClass("active");
  $.get("{{ url_for('.clean_topic') }}", {}, function(data){
    // 
    $("#result p").append("共清理了 "+data.delete+" 个主题！");
    $('#result').show().transition('tada');
    // alert("共清理了"+data.delete+"个主题。");
  });
  timeSet = setInterval(get_progress, 300);

});

get_progress = function() {
  $.get("{{ url_for('.get_clean_progress') }}", {"_": Math.random()}, function(data){
    $("#progress").css("width", data.progress+"%");
    if (data.progress == "100") {
      clearInterval(timeSet);
      $("#progress").parent().removeClass("active");
    }
  });
}



</script>
{% endblock %}






